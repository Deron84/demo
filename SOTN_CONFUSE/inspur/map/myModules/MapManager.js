define(["esri/map","esri/layers/WebTiledLayer","utils/GeometryUtil","esri/layers/GraphicsLayer","esri/graphic","utils/SymbolUtil","esri/geometry/webMercatorUtils","esri/toolbars/draw","dojo/_base/declare"],function(c,g,e,d,h,i,b,a,f){return f(null,{map:null,constructor:function(){var n=new c("map",Global.mapGlobal.mapInstance.mapOptions);this.map=n;Global.mapGlobal.map=n;if(Global.mapGlobal.mapInstance.isCenter){n.centerAndZoom(e.getPoint(Global.mapGlobal.mapInstance.center[0],Global.mapGlobal.mapInstance.center[1],""),Global.mapGlobal.mapInstance.zoom)}var k=new g(Global.mapGlobal.base.map,{copyright:"Heditu",id:"baseMap"});n.addLayer(k);var o=new d();n.addLayer(o);Global.mapGlobal.lineLayer=o;var m=new d();n.addLayer(m);Global.mapGlobal.otnLayer=m;var j=this;j.drawingGraphics(j);j.realQueryWarningOTN(j);var l=[139.565+200,-23.565-10];console.log("xx",b.lngLatToXY(l[0],l[1]))},drawingGraphics:function(j){$.get(Global.mapGlobal.queryPOI.queryOTN,function(k){if(k&&k.nodes){if(k.edges){j._drawingLines(k.edges)}j._drawingPoints(k.nodes);j.queryWarningOTN(j)}})},realQueryWarningOTN:function(j){if(Global.mapGlobal.queryPOI.realQueryFlag){setInterval(function(){j.queryWarningOTN(j)},Global.mapGlobal.queryPOI.realQueryTimer)}},_drawingLines:function(j){j.map(function(p,l){var o=e.getPoint(p.a_longitude,p.a_lantitude,"");var n=e.getPoint(p.z_longitude,p.z_lantitude,"");var k=e.getPolylineByPoints(o,n);var m=new h(k,i.getLineSymbol(),p);Global.mapGlobal.lineLayer.add(m)})},_drawingPoints:function(j){j.map(function(m,k){var n=e.getPoint(m.longitude,m.lantitude,"");var l=new h(n,i.getOTNSymbol(),m);Global.mapGlobal.otnLayer.add(l)})},queryWarningOTN:function(j){$.get(Global.mapGlobal.queryPOI.queryWarningOTN,function(k){if(k&&k.site){j._handlerOTNWarning(k.site)}if(k&&k.topolink){j._handlerLineWarning(k.topolink)}})},_handlerOTNWarning:function(j){j.map(function(l,k){Global.mapGlobal.otnLayer.graphics.map(function(n,m){if(n.attributes.oid==l){n.setSymbol(i.getOTNWarningSymbol())}})})},_handlerLineWarning:function(j){j.map(function(l,k){Global.mapGlobal.lineLayer.graphics.map(function(o,n){var m=false;o.attributes.aggr.map(function(p,q){if(p.oid==l){m=true}});if(m){o.setSymbol(i.getWarningLineSymbol())}})})}})});